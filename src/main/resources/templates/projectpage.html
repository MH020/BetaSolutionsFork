<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>List of all employees</title>
    <link th:href="@{/style/style.css}" rel="stylesheet">
</head>
<body>

<header>
    <a th:href="@{/home}" class="logo">
        <h1><span class="beta">Beta</span><span class="solutions">Solutions</span></h1>
    </a>

    <form class="logo" method="get" th:action="@{/login}" style="display:inline;">
        <button type="submit">Log out</button>
    </form>
</header>

<h2>
    <span style="font-size: 2em;" class="project" th:text="${project.name}"></span>
    </span> Project owner: <span th:text="${project.owner}"></span>
</h2>

<aside>
    <h2>Start date: <span th:text="${project.getStartDate()}"></span></h2>
    <h2> Deadline: <span th:text="${project.getDeadline()}"></span></h2>
    <h2> Total price: <span th:text="${project.getTotalPrice()}"></span></h2>
    <h2> Days: <span th:text="${project.getDays()}"></span></h2>
</aside>

<main>
    <form class="logo" method="get" th:action="@{/project/{id}/employees (id=${projectID})}" style="display:inline;">
        <button type="submit">All employees for project</button>
        <hidden name="projectID" field="projectID"> </hidden>
    </form>
    <br>

    <h2>Project with tasks:</h2>
    <form th:action="@{/project/{projectID}/New/task(projectID=${project.getID()})}" method="get">
        <button type="submit">Create a new task</button>
    </form>

    <table>
        <tr>
            <th>ID</th>
            <th>Task name</th>
            <th>Days</th>
            <th>Deadline</th>
            <th>Start date</th>
        </tr>

        <!-- Loop through subprojects -->
        <tr th:each="task : ${tasksWithoutSubProject}" class="task">
            <td th:text="${task.ID}"></td>
            <td th:text="${task.name}"></td>
            <td th:text="${task.days}"></td>
            <td th:text="${task.deadline}"></td>
            <td th:text="${task.startDate}"></td><!-- Delete button for each task -->
            <td>
                <!-- Button to navigate to subtasks page -->
                <form th:action="@{/project/{projectID}/task/{taskID}/subtasks(projectID=${project.getID()}, taskID=${task.getID()})}" method="get">
                    <button type="submit">Subtasks</button>
                </form>
            </td>
            <td>
                <form th:action="@{/project/task/delete(taskID=${task.getID()}, projectID=${project.getID()})}" method="post"
                      onsubmit="return confirm('Are you sure you want to delete this task?');">
                    <button type="submit" class="delete-button">Delete Task</button>
                </form> </td>
        </tr>
    </table>

    <br>
    <br>

    <h2>Subprojects with tasks:</h2>
    <!-- Button to create a new subproject -->
    <form th:action="@{/project/{projectID}/subproject/newSubProject(projectID=${project.getID()})}" method="get">
        <button type="submit">Create a new subproject</button>
    </form>

    <table>
    <thead>
        <tr>
            <th>SubProject Name</th>
            <th>Hours</th>
            <th>Deadline</th>
            <th>Start Date</th>
            <th>Total Price</th>
            <th>Days</th>
            <th>Tasks</th>
            <th>Subtasks</th>
        </tr>
    </thead>
    <tbody>
        <tr th:each="entry : ${subProjects}" class="subproject">
            <td th:text="${entry.key.name}"></td>
            <td th:text="${entry.key.getHours()}"></td>
            <td th:text="${entry.key.getDeadline()}"></td>
            <td th:text="${entry.key.getStartDate()}"></td>
            <td th:text="${entry.key.getTotalPrice()}"></td>
            <td th:text="${entry.key.getDays()}"></td>
            <td>
                <form th:action="@{/project/{projectID}/subproject/{subProjectID}/New/task(projectID=${project.getID()}, subProjectID=${entry.key.getID()})}" method="get">
                    <button type="submit">Create task for subproject</button>
                </form>
                <table>
                    <thead>
                        <tr>
                            <th>Task Name</th>
                            <th>Hours</th>
                            <th>Delete Task</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:if="${#lists.isEmpty(entry.value)}">
                            <td colspan="3">No tasks for this subproject</td>
                        </tr>
                        <tr th:each="task : ${entry.value}" class="task">
                            <td th:text="${task.getName()}" class="task"></td>
                            <td th:text="${task.getHours()}" class="task"></td>
                            <td>
                                <form th:action="@{/project/task/delete(taskID=${task.getID()}, projectID=${project.getID()})}" method="post" onsubmit="return confirm('Are you sure you want to delete this task?');">
                                    <button type="submit" class="delete-button">Delete Task</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
            <td>
                <!-- Button to navigate to subtasks page BUT ITS WRONG  -->
                <form th:action="@{/project/{projectID}/subproject/{subProjectID}/subtasks(projectID=${project.getID()}, subProjectID=${entry.key.getID()})}" method="get">
                    <button type="submit">View subtasks</button>
                </form>
        </tr>
    </tbody>
</table>

</main>
</body>
</html>